image: ruby:2.3

cache:
  paths:
    - web/app/themes/casey/node_modules/

build_stage:
  script:
    - gem install bundler
    - bundle install
    - composer install
    - cd web/app/themes/casey
    - composer install
    - npm install
    - yarn run build:production
    - cd ../../../../
    - cap staging deploy --trace
  stage: build
  only:
    - stage
